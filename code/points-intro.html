<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>è¢å¹•æ™‚é–“ç®¡ç†ç³»çµ± | Points & Screen Time</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Outfit:wght@400;700;900&display=swap"
    rel="stylesheet">

  <style>
    /* ----------------------------------
       ğŸ¨ Design Tokens & Reset
    ---------------------------------- */
    :root {
      --primary: #00E5FF;
      --primary-glow: rgba(0, 229, 255, 0.6);
      --secondary: #2979FF;
      --accent: #FF2E93;
      --bg-dark: #080812;
      --bg-panel: rgba(255, 255, 255, 0.03);
      --glass-border: rgba(255, 255, 255, 0.08);
      --text-main: #FFFFFF;
      --text-muted: #94A3B8;

      --font-display: 'Outfit', sans-serif;
      --font-body: 'Inter', sans-serif;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-body);
      background-color: var(--bg-dark);
      color: var(--text-main);
      margin: 0;
      padding: 0;
      line-height: 1.6;
      overflow-x: hidden;
      background-image:
        radial-gradient(circle at 15% 50%, rgba(41, 121, 255, 0.08), transparent 25%),
        radial-gradient(circle at 85% 30%, rgba(255, 46, 147, 0.08), transparent 25%);
      background-attachment: fixed;
    }

    h1,
    h2,
    h3,
    h4 {
      font-family: var(--font-display);
      margin: 0;
      font-weight: 700;
    }

    a {
      text-decoration: none;
      color: inherit;
      transition: 0.3s;
    }

    /* ----------------------------------
       ğŸŒŒ Hero Section
    ---------------------------------- */
    .hero {
      position: relative;
      padding: 120px 20px 80px;
      text-align: center;
      overflow: hidden;
    }

    /* Ambient Glow Background */
    .hero::before {
      content: '';
      position: absolute;
      top: -50%;
      left: 50%;
      transform: translateX(-50%);
      width: 1200px;
      height: 800px;
      background: radial-gradient(closest-side, rgba(0, 229, 255, 0.15), transparent);
      z-index: -1;
      pointer-events: none;
    }

    .hero-badge {
      display: inline-block;
      padding: 6px 16px;
      background: rgba(0, 229, 255, 0.1);
      border: 1px solid rgba(0, 229, 255, 0.3);
      border-radius: 50px;
      color: var(--primary);
      font-size: 0.9em;
      font-weight: 600;
      margin-bottom: 24px;
      letter-spacing: 0.05em;
      backdrop-filter: blur(5px);
    }

    .hero h1 {
      font-size: clamp(2.5rem, 5vw, 4rem);
      line-height: 1.1;
      margin-bottom: 24px;
      background: linear-gradient(135deg, #FFFFFF 0%, #B0C4DE 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 40px rgba(0, 229, 255, 0.3);
    }

    .hero .tagline {
      font-size: clamp(1.1rem, 2vw, 1.25rem);
      color: var(--text-muted);
      max-width: 680px;
      margin: 0 auto 40px;
      font-weight: 300;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
    }

    /* ----------------------------------
       ğŸ”˜ Buttons
    ---------------------------------- */
    .cta-group {
      display: flex;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
    }

    .btn {
      padding: 16px 36px;
      border-radius: 12px;
      font-family: var(--font-display);
      font-weight: 700;
      font-size: 1.1em;
      letter-spacing: 0.02em;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      border: none;
    }

    .btn-primary {
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      color: #fff;
      box-shadow: 0 10px 30px rgba(0, 229, 255, 0.3);
    }

    .btn-primary::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transition: 0.5s;
    }

    .btn-primary:hover {
      transform: translateY(-3px);
      box-shadow: 0 20px 40px rgba(0, 229, 255, 0.5);
    }

    .btn-primary:hover::before {
      left: 100%;
    }

    .btn-secondary {
      background: rgba(255, 255, 255, 0.05);
      color: #fff;
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(10px);
    }

    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.3);
    }

    /* ----------------------------------
       ğŸ§Š Glass Cards (Features)
    ---------------------------------- */
    .features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 24px;
      max-width: 1100px;
      margin: 60px auto 100px;
      padding: 0 24px;
    }

    .feature-card {
      background: var(--bg-panel);
      border: 1px solid var(--glass-border);
      padding: 32px;
      border-radius: 20px;
      backdrop-filter: blur(16px);
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      position: relative;
      overflow: hidden;
    }

    .feature-card:hover {
      transform: translateY(-8px) scale(1.02);
      border-color: rgba(0, 229, 255, 0.3);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
      background: rgba(255, 255, 255, 0.05);
    }

    .feature-card h3 {
      font-size: 1.4rem;
      margin-bottom: 12px;
      color: var(--primary);
    }

    .feature-card p {
      color: var(--text-muted);
      font-size: 0.95rem;
      margin: 0;
    }

    /* Decorative circles on cards */
    .feature-card::after {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 100px;
      height: 100px;
      background: radial-gradient(circle, rgba(255, 255, 255, 0.05) 0%, transparent 70%);
      border-radius: 50%;
      pointer-events: none;
    }

    /* ----------------------------------
       ğŸ“œ Content / Setup Area
    ---------------------------------- */
    .container {
      max-width: 900px;
      margin: 0 auto 80px;
      padding: 0 24px;
    }

    h2.section-title {
      font-size: 2rem;
      text-align: center;
      margin-bottom: 40px;
      background: linear-gradient(90deg, #fff, #94A3B8);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    /* Setup Panel (Static) */
    .setup-panel {
      background: var(--bg-panel);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      margin-bottom: 20px;
      overflow: hidden;
    }

    .setup-panel h2 {
      margin: 0;
      padding: 20px 24px;
      font-size: 1.2rem;
      background: rgba(255, 255, 255, 0.02);
      border-bottom: 1px solid var(--glass-border);
    }

    .panel-content {
      padding: 20px 0;
      background: #000;
    }

    /* Code Block Styling */
    .section {
      padding: 0;
      border: none;
      background: transparent;
    }

    .section h2 {
      font-family: 'Outfit', sans-serif;
      font-size: 1.6rem;
      font-weight: 700;
      color: #fff;

      /* Cyberpunk Glass Style */
      background: linear-gradient(90deg, rgba(0, 212, 255, 0.1), rgba(0, 0, 0, 0));
      border: 1px solid rgba(0, 212, 255, 0.2);
      border-left: 6px solid var(--primary);
      border-radius: 4px;
      backdrop-filter: blur(5px);

      padding: 20px 24px;
      margin: 30px 0 20px;

      /* Neon Glows */
      text-shadow: 0 0 15px rgba(0, 212, 255, 0.6);
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3), inset 0 0 20px rgba(0, 212, 255, 0.05);

      letter-spacing: 1px;
      text-transform: uppercase;
    }

    .section p {
      padding: 15px 24px 0;
      font-size: 0.9em;
      color: #888;
    }

    textarea {
      width: 100%;
      height: 400px;
      background: #0e0e11;
      color: #a6accd;
      /* Dracula theme-ish text */
      border: none;
      padding: 24px;
      font-family: 'JetBrains Mono', 'Consolas', monospace;
      font-size: 13px;
      line-height: 1.5;
      resize: vertical;
      outline: none;
    }

    .copy-btn-wrap {
      padding: 0 24px 15px;
      text-align: right;
    }

    button.copy-btn {
      background: #222;
      color: #fff;
      border: 1px solid #444;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 12px;
      cursor: pointer;
      transition: 0.2s;
    }

    button.copy-btn:hover {
      background: var(--primary);
      color: #000;
      border-color: var(--primary);
    }

    /* Footer */
    .footer-nav {
      text-align: center;
      padding: 60px 0;
      color: var(--text-muted);
      font-size: 0.9rem;
      border-top: 1px solid var(--glass-border);
      background: linear-gradient(to bottom, transparent, rgba(0, 0, 0, 0.5));
    }

    .footer-nav a {
      border-bottom: 1px dotted #555;
    }

    .footer-nav a:hover {
      color: var(--primary);
      border-bottom-color: var(--primary);
    }
  </style>
  <script>
    function copyId(id) {
      const el = document.getElementById(id);
      el.select();
      document.execCommand('copy');
      // Stylish Toast could go here, but alert is robust
      alert('å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿! (Copied)');
    }
  </script>
</head>

<body>

  <!-- Hero Section -->
  <div class="hero">
    <div class="hero-badge">âœ¨ V2.0 Screen Time Manager</div>
    <h1>MAKE TIME<br>VISIBLE</h1>
    <div class="tagline">
      æŠŠéš±å½¢çš„ã€Œæ™‚é–“ã€è®Šæˆå­©å­çœ‹å¾—è¦‹çš„ã€Œé»æ•¸ã€ã€‚<br>
      è¦–è¦ºåŒ–ç®¡ç† Ã— é»æ•¸ç¶“æ¿Ÿ Ã— æ­£å‘æ•™é¤Š
    </div>

    <div class="cta-group">
      <a href="points-demo.html" class="btn btn-primary">
        ğŸš€ ç«‹å³é«”é©— Demo
      </a>
      <a href="#setup-guide" class="btn btn-secondary">
        ğŸ“– éƒ¨ç½²æ•™å­¸
      </a>
    </div>
  </div>

  <!-- Features Grid -->
  <div class="features">
    <div class="feature-card">
      <h3>ğŸ“Š è¦–è¦ºåŒ–é€²åº¦</h3>
      <p>æ¡ç”¨ç´…ç¶ ç‡ˆæ¦‚å¿µçš„å‹•æ…‹æ¼¸å±¤é€²åº¦æ¢ï¼Œè®“å­©å­ä¸€çœ¼æŒæ¡å‰©é¤˜æ™‚é–“ã€‚</p>
    </div>
    <div class="feature-card">
      <h3>ğŸ’° é»æ•¸ç¶“æ¿Ÿ</h3>
      <p>å»ºç«‹ã€Œæ™‚é–“å³é‡‘éŒ¢ã€çš„è§€å¿µã€‚çœä¸‹çš„è¢å¹•æ™‚é–“å¯è½‰æ›ç‚ºé»æ•¸ï¼Œç´¯ç©å…Œæ›çå‹µã€‚</p>
    </div>
    <div class="feature-card">
      <h3>ğŸš€ å¿«é€Ÿéƒ¨ç½²</h3>
      <p>æ”¯æ´ç´”éœæ…‹é‹è¡Œ (Local) æˆ–ä¸²æ¥ Google Sheets (Online)ï¼Œå…ç§Ÿä¼ºæœå™¨ã€‚</p>
    </div>
    <div class="feature-card">
      <h3>â˜ï¸ è·¨è£ç½®åŒæ­¥</h3>
      <p>ä¸²æ¥ Google Apps Script å¾Œï¼Œçˆ¸çˆ¸çš„æ‰‹æ©Ÿã€åª½åª½çš„é›»è…¦éƒ½èƒ½å³æ™‚æ§ç®¡ã€‚</p>
    </div>
    <div class="feature-card">
      <h3>âš™ï¸ é«˜åº¦å®¢è£½</h3>
      <p>å¹³æ—¥ 50 åˆ†é˜ã€å‡æ—¥ 90 åˆ†é˜ï¼ŸåŒ¯ç‡ 1:5ï¼Ÿæ‰€æœ‰åƒæ•¸çš†å¯è‡ªç”±è¨­å®šã€‚</p>
    </div>
    <div class="feature-card">
      <h3>ğŸ§¸ å¤šå¸³æˆ¶ç®¡ç†</h3>
      <p>å¾Œå°æ”¯æ´å¤šäººæ‰¹æ¬¡æ“ä½œï¼Œä¸€æ¬¡ç®¡ç†å¤šä½å­©å­çš„æ™‚é–“å¸³æˆ¶ã€‚</p>
    </div>
  </div>

  <div class="container">
    <h2 class="section-title">Get Started</h2>

    <!-- Setup Guide (Static) -->
    <div class="setup-panel" id="setup-guide">
      <h2>
        <span>ğŸ“– å®Œæ•´è¨­å®šæ•™å­¸èˆ‡åŸå§‹ç¢¼</span>
      </h2>
      <div class="panel-content">


        <!-- Section 1: Local Demo -->
        <div class="section">
          <h2>1. ç´”å‰ç«¯æœ¬æ©Ÿç‰ˆ (Local Demo)</h2>
          <p>ä»¥ä¸‹æ˜¯å®Œæ•´çš„ Local Demo ç¨‹å¼ç¢¼ï¼Œè¤‡è£½å­˜æˆ html å³å¯ä½¿ç”¨ã€‚</p>
          <button onclick="copyId('code-local')">è¤‡è£½åŸå§‹ç¢¼</button>
          <textarea id="code-local" readonly>
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
  <title>Points & Screen Time (Demo Version)</title>
  
  <link href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-dark@4/dark.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

  <style>
    :root {
      --primary: #00d4ff;
      --primary-hover: #00b8dd;
      --bg-dark: #111;
      --bg-card: #1c1c3c;
      --bg-input: #222;
      --text-main: #eee;
      --text-muted: #bbb;
      --radius-lg: 20px;
      --shadow-glow: 0 4px 15px rgba(0, 212, 255, 0.3);
    }
    body {
      font-family: 'Poppins', system-ui, -apple-system, 'Noto Sans TC', sans-serif;
      background: var(--bg-dark);
      color: var(--text-main);
      text-align: center;
      padding: 20px 10px;
      margin: 0;
      -webkit-tap-highlight-color: transparent;
    }
    h1 { margin: 10px 0 5px; letter-spacing: 1px; }
    .subtitle { font-size: 14px; color: #888; margin-bottom: 20px; }

    /* --- å¡ç‰‡æ¨£å¼ --- */
    .child-card {
      background: var(--bg-card);
      padding: 24px;
      margin: 18px auto;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-glow);
      max-width: 440px;
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.05);
    }
    .child-name { font-size: 26px; font-weight: 700; color: var(--primary); margin-bottom: 12px; }
    .points-box {
      background: rgba(0, 0, 0, 0.3);
      padding: 16px;
      border-radius: 16px;
      font-size: 36px;
      font-weight: 800;
      color: var(--primary);
      margin-bottom: 12px;
      border: 1px solid rgba(0, 212, 255, 0.1);
      text-shadow: 0 0 10px rgba(0, 212, 255, 0.4);
    }
    .conversion-info { font-size: 13px; color: var(--text-muted); margin-top: 6px; font-weight: normal; }

    /* --- é€²åº¦æ¢å€å¡Š --- */
    .progress-dual { display: grid; grid-template-columns: 1fr; gap: 12px; margin-bottom: 10px; }
    .progress-title { font-size: 14px; color: var(--primary); margin: 6px 0 4px; display: flex; justify-content: space-between; padding: 0 8px; }
    .bar-wrap {
      background: #222;
      border: 2px solid rgba(0, 212, 255, 0.3);
      border-radius: 30px;
      overflow: hidden;
      height: 36px;
      width: 100%;
      position: relative;
    }
    .fill {
      height: 100%;
      width: 0%;
      transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      background: linear-gradient(90deg, var(--primary), #005eff);
      box-shadow: 0 0 10px var(--primary);
    }
    .fill.warning { background: linear-gradient(90deg, #ffaa00, #ff7700); box-shadow: 0 0 10px #ffaa00; }
    .fill.danger { background: linear-gradient(90deg, #ff4444, #ff0000); box-shadow: 0 0 10px #ff0000; }
    .bar-text {
      position: absolute; width: 100%; text-align: center; top: 0; line-height: 36px;
      font-weight: 700; color: #fff; font-size: 15px; text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
      z-index: 2; pointer-events: none;
    }

    /* --- æŒ‰éˆ•èˆ‡æ§åˆ¶å€ --- */
    .control-row { display: grid; grid-template-columns: 1fr; gap: 12px; margin: 16px 0; }
    .control-row .right { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
    .deduct-btn {
      padding: 10px 0; font-size: 15px; border-radius: 12px; border: none;
      background: #333; color: #ccc; cursor: pointer; transition: 0.2s;
    }
    .deduct-btn:active { background: #555; transform: scale(0.95); }

    .chip-toggle {
      background: #222; border-radius: 999px; padding: 4px; display: inline-flex; gap: 4px; justify-content: center; margin-bottom: 8px;
    }
    .chip-toggle button {
      border: none; padding: 8px 16px; border-radius: 999px; background: transparent;
      color: #888; cursor: pointer; font-weight: 600; transition: 0.3s;
    }
    .chip-toggle button.active { background: var(--primary); color: #111; box-shadow: 0 2px 8px rgba(0, 212, 255, 0.4); }

    .convert-group { display: flex; justify-content: center; gap: 12px; margin-top: 8px; }
    .btn {
      padding: 10px 16px; font-size: 15px; border: none; border-radius: 12px; width: 100%;
      color: #eee; font-weight: 700; cursor: pointer; background: #444; transition: 0.2s;
    }
    .btn:hover { background: #555; }
    .btn.primary { background: var(--primary); color: #111; }
    .btn:active { transform: scale(0.96); }

    /* --- è¡¨å–®å€ --- */
    #form-section {
      background: #2a2a5a; padding: 24px 20px; border-radius: 24px;
      max-width: 440px; margin: 24px auto 60px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }
    input[type="number"], input[type="text"], button.submit-btn {
      padding: 12px; margin: 8px 0; font-size: 16px; border-radius: 10px;
      border: none; width: 100%; box-sizing: border-box;
    }
    input { background: rgba(0, 0, 0, 0.3); color: #fff; border: 1px solid #444; text-align: center; }
    input:focus { outline: none; border-color: var(--primary); }
    .submit-btn {
      background: var(--primary); color: #111; font-weight: 800; margin-top: 12px;
      box-shadow: 0 4px 12px rgba(0, 212, 255, 0.4); cursor: pointer;
    }
    .submit-btn:active { transform: scale(0.98); }

    /* æ–¹æ¡ˆåˆ‡æ› */
    .plan-toggle { background: #222; border-radius: 999px; padding: 4px; display: inline-flex; gap: 4px; margin-top: 10px; }
    .btn-plan {
      border: none; padding: 8px 20px; border-radius: 999px; background: transparent;
      color: #888; cursor: pointer; font-weight: 600; transition: 0.2s;
    }
    .btn-plan.active { background: var(--primary); color: #111; }

    /* --- Checkbox Group --- */
    .checkbox-group { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 15px; }
    .checkbox-group input { display: none; }
    .checkbox-group label {
      display: block; padding: 14px; background: #333; color: #ccc; border-radius: 12px;
      font-size: 18px; cursor: pointer; user-select: none; transition: 0.2s; border: 2px solid transparent;
    }
    .checkbox-group input:checked+label {
      background: rgba(0, 212, 255, 0.1); color: var(--primary); border-color: var(--primary); font-weight: bold;
    }

    /* Name Item Wrapper */
    .kid-check-wrapper { position: relative; }
    .kid-check-wrapper button.edit-icon {
      position: absolute; top: 8px; right: 8px;
      background: rgba(0, 0, 0, 0.4); border: none; color: #666; width: 24px; height: 24px;
      border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center;
      font-size: 14px; transition: 0.2s;
    }
    .kid-check-wrapper button.edit-icon:hover { background: rgba(255, 255, 255, 0.2); color: #fff; }

    /* Add Name Area */
    .add-name-area { display: flex; gap: 8px; margin-bottom: 20px; }
    .add-name-area input { margin: 0; text-align: left; }
    .add-name-area button {
      width: 50px; background: #444; color: #fff; border: none; border-radius: 10px; cursor: pointer; font-size: 20px; font-weight: bold;
    }
    .add-name-area button:hover { background: #555; }

    .pair { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .note { font-size: 12px; color: #888; margin-top: 12px; line-height: 1.6; }
    .preview { margin-top: 8px; font-size: 13px; color: #9ecfff; }

    /* Demo æç¤º */
    .demo-alert {
      background: rgba(255, 200, 0, 0.15); color: #ffca28; font-size: 13px;
      padding: 10px; border-radius: 8px; border: 1px solid rgba(255, 200, 0, 0.3);
      max-width: 440px; margin: 0 auto 20px; text-align: left;
    }
    .demo-alert strong { color: #fff; }

    /* SweetAlert è‡ªå®šç¾©æ¨£å¼ */
    .swal2-popup { border-radius: 20px !important; background: #222 !important; border: 1px solid #444; }
    .swal2-title { color: #fff !important; }
    .swal2-content { color: #ccc !important; }
  </style>
</head>

<body>

  <h1>â­ Points & Screen Time ğŸ“º</h1>
  <div class="subtitle">Live Demo / Local Storage Version</div>

  <div class="demo-alert">
    <strong>ğŸ’¡ é€™æ˜¯é«”é©—ç‰ˆæœ¬ (Local Demo)</strong><br>
    æ‰€æœ‰æ“ä½œåªæœƒå„²å­˜åœ¨æ‚¨çš„ç€è¦½å™¨ä¸­ï¼Œä¸æœƒä¸Šå‚³åˆ°ä»»ä½•ä¼ºæœå™¨ã€‚æ‚¨å¯ä»¥è‡ªç”±æ¸¬è©¦åŠ åˆ†ã€æ‰£åˆ†èˆ‡å…Œæ›åŠŸèƒ½ï¼
  </div>

  <div id="leaderboard"></div>

  <div id="form-section">
    <h2 style="margin-top:0;color:#fff;">ç®¡ç†å¾Œå° ğŸ“</h2>

    <div id="name-list" class="checkbox-group"></div>

    <!-- æ–°å¢åå­—å€å¡Š -->
    <div class="add-name-area">
      <input type="text" id="newKidName" placeholder="+ æ–°å¢åå­—..." style="background:rgba(255,255,255,0.1);border:1px dashed #666;">
      <button onclick="addNewKid()">ï¼‹</button>
    </div>

    <div class="plan-toggle">
      <button type="button" id="alloc-weekday" class="btn-plan active" onclick="setAllocPlan('weekday')">å¹³æ—¥</button>
      <button type="button" id="alloc-holiday" class="btn-plan" onclick="setAllocPlan('holiday')">å‡æ—¥</button>
    </div>
    <div id="alloc-preview" class="preview">â€”</div>

    <input type="number" id="pointsChange" placeholder="â­ é»æ•¸èª¿æ•´ (è¼¸å…¥æ­£æ•¸æœ‰ç‰¹æ•ˆ)">
    <input type="number" id="screenTimeChange" placeholder="ğŸ“º è¢å¹•æ™‚é–“å¢æ¸›">
    <input type="text" id="reason" placeholder="åŸå›  (é¸å¡«)">

    <button type="button" class="submit-btn" onclick="submitData()">åŸ·è¡Œæ›´æ–° ğŸš€</button>

    <div class="note">
      è¦å‰‡ï¼šâ­1é» â‡„ ğŸ“º2åˆ†é˜<br>
      <a href="#" onclick="resetDemoData();return false;" style="color:#666;text-decoration:underline;">é‡ç½®æ‰€æœ‰æ•¸æ“š</a>
    </div>
  </div>

  <div style="margin-top:40px;font-size:12px;color:#555;">
    Template by Evelyn YT | Demo Version | <a href="points-intro.html" style="color:#777;">å–å¾—åŸå§‹ç¢¼ & è·¨è£ç½®è¨­å®š</a>
  </div>

  <script>
    // ==========================================
    // âš™ï¸ è¨­å®šå€ (å¯ä»¥è®“ä½¿ç”¨è€…è‡ªå·±ä¿®æ”¹)
    // ==========================================
    const CONFIG = {
      // å°å­©åå–®èˆ‡åˆå§‹å€¼
      DEFAULT_KIDS: [
        { Name: 'Mario', TotalPoints: 10, TotalMinutes: 45 },
        { Name: 'Luigi', TotalPoints: 5, TotalMinutes: 15 },
        { Name: 'Peach', TotalPoints: 25, TotalMinutes: 30 }
      ],
      // æ–¹æ¡ˆä¸Šé™
      LIMITS: { weekday: 50, holiday: 90 },
      // LocalStorage Key
      STORAGE_KEY: 'screenTime_demo_v2'
    };
    // ==========================================

    let currentData = [];
    let allocPlan = 'weekday';

    document.addEventListener('DOMContentLoaded', () => {
      loadData();
      syncAllocPlanButtons();
      updateAllocPreview();
    });

    // --- è³‡æ–™è™•ç†æ ¸å¿ƒ (Local Logic) ---

    function loadData() {
      const saved = localStorage.getItem(CONFIG.STORAGE_KEY);
      if (saved) {
        currentData = JSON.parse(saved);
      } else {
        currentData = JSON.parse(JSON.stringify(CONFIG.DEFAULT_KIDS));
        saveData();
      }
      renderLeaderboard();
    }

    function saveData() {
      localStorage.setItem(CONFIG.STORAGE_KEY, JSON.stringify(currentData));
      renderLeaderboard();
    }

    function resetDemoData() {
      Swal.fire({
        title: 'é‡ç½®è³‡æ–™?',
        text: "å°‡æ¢å¾©åˆ°é è¨­ç‹€æ…‹",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        background: '#333', color: '#fff'
      }).then((result) => {
        if (result.isConfirmed) {
          localStorage.removeItem(CONFIG.STORAGE_KEY);
          loadData();
          Swal.fire({ icon: 'success', title: 'å·²é‡ç½®', timer: 1000, showConfirmButton: false, background: '#333', color: '#fff' });
        }
      });
    }

    // --- UI æ¸²æŸ“ ---

    function renderLeaderboard() {
      const board = document.getElementById('leaderboard');
      const nameBox = document.getElementById('name-list');

      const oldChecks = new Set([...document.querySelectorAll('#name-list input:checked')].map(c => c.value));
      nameBox.innerHTML = '';

      let html = '';
      const maxTime = CONFIG.LIMITS[allocPlan];

      currentData.forEach(entry => {
        const cid = `chk-${entry.Name}`;
        const isChecked = oldChecks.has(entry.Name) ? 'checked' : '';
        nameBox.innerHTML += `
        <div class="kid-check-wrapper">
          <input type="checkbox" id="${cid}" value="${entry.Name}" ${isChecked}>
          <label for="${cid}">${entry.Name}</label>
          <button class="edit-icon" onclick="editKid('${entry.Name}'); event.preventDefault();">âœ</button>
        </div>
      `;

        const mins = entry.TotalMinutes || 0;
        const pts = entry.TotalPoints || 0;
        const pct = Math.min(100, (mins / maxTime) * 100);
        const barClass = pct <= 20 ? 'danger' : (pct <= 50 ? 'warning' : '');

        html += `
        <div class="child-card">
          <div class="child-name">${entry.Name}</div>

          <div class="points-box">
            â­ ${pts}
             <div class="conversion-info">
                å¯æ›ï¼šğŸ“º ${pts * 2}m <span style="margin:0 5px;color:#555">|</span> ğŸ’° $${pts * 5}
             </div>
          </div>

          <div class="progress-dual">
            <div>
              <div class="progress-title">
                <span>ğŸ“º è¢å¹•æ™‚é–“</span> <span style="font-size:12px;color:#666">ä¸Šé™: ${maxTime}m</span>
              </div>
              <div class="bar-wrap">
                <div class="fill ${barClass}" style="width:${pct}%"></div>
                <div class="bar-text">${mins}m</div>
              </div>
            </div>
          </div>

          <div class="control-row">
             <div class="right" style="width:100%; grid-template-columns: repeat(3, 1fr);">
                <button class="deduct-btn" onclick="quickDeduct('${entry.Name}', 10)">-10</button>
                <button class="deduct-btn" onclick="quickDeduct('${entry.Name}', 30)">-30</button>
                <button class="deduct-btn" style="color:#ff6666" onclick="customDeduct('${entry.Name}')">è‡ªè¨‚</button>
             </div>
          </div>

          <div class="convert-group">
            <button class="btn" onclick="convertTimeToPoints('${entry.Name}')">ğŸ“º â” â­</button>
            <button class="btn primary" onclick="convertPointsToTime('${entry.Name}')">â­ â” ğŸ“º</button>
          </div>
        </div>
        `;
      });

      board.innerHTML = html;
    }

    // --- è¡¨å–®èˆ‡è¨­å®šé‚è¼¯ ---

    function setAllocPlan(plan) {
      allocPlan = plan;
      syncAllocPlanButtons();
      updateAllocPreview(true);

      document.getElementById('screenTimeChange').value = CONFIG.LIMITS[plan];
      document.getElementById('reason').value = `${plan === 'weekday' ? 'å¹³æ—¥' : 'å‡æ—¥'}åˆ†é…`;

      renderLeaderboard();
    }

    function syncAllocPlanButtons() {
      document.querySelectorAll('.btn-plan').forEach(b => b.classList.remove('active'));
      document.getElementById(allocPlan === 'weekday' ? 'alloc-weekday' : 'alloc-holiday').classList.add('active');
    }

    function updateAllocPreview(bump) {
      const el = document.getElementById('alloc-preview');
      const lim = CONFIG.LIMITS[allocPlan];
      el.textContent = `ç•¶å‰ï¼š${allocPlan === 'weekday' ? 'å¹³æ—¥' : 'å‡æ—¥'} (ä¸Šé™ ${lim}m) `;
      if (bump) {
        el.style.transform = 'scale(1.1)';
        el.style.transition = '0.2s';
        setTimeout(() => el.style.transform = 'scale(1)', 200);
      }
    }

    // --- è³‡æ–™æ“ä½œ (Actions) ---

    function submitData() {
      const checked = [...document.querySelectorAll('#name-list input:checked')];
      if (checked.length === 0) return Swal.fire({ icon: 'warning', title: 'è«‹é¸æ“‡å°è±¡', background: '#333', color: '#fff' });

      const pts = parseInt(document.getElementById('pointsChange').value) || 0;
      const timeChange = parseInt(document.getElementById('screenTimeChange').value) || 0;

      if (pts === 0 && timeChange === 0) return Swal.fire({ icon: 'info', title: 'æ•¸å€¼æœªè®Šæ›´', background: '#333', color: '#fff' });

      if (pts > 0) {
        confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: ['#00d4ff', '#ff0', '#f0f'] });
      }

      checked.forEach(cb => {
        modifyKidData(cb.value, pts, timeChange);
      });

      document.getElementById('pointsChange').value = '';
      document.getElementById('screenTimeChange').value = '';
      document.getElementById('name-list').querySelectorAll('input').forEach(i => i.checked = false);

      Swal.fire({ icon: 'success', title: 'æ›´æ–°æˆåŠŸ', timer: 1000, showConfirmButton: false, background: '#333', color: '#fff' });
    }

    function quickDeduct(name, minutes) {
      const kid = currentData.find(k => k.Name === name);

      if (kid.TotalMinutes < minutes) return Swal.fire({ icon: 'error', title: 'æ™‚é–“ä¸è¶³', text: `ç›®å‰åªæœ‰ ${kid.TotalMinutes} åˆ†`, background: '#333', color: '#fff' });

      Swal.fire({
        title: `æ‰£é™¤ ${minutes} åˆ†?`,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        confirmButtonText: 'æ‰£é™¤',
        background: '#333', color: '#fff'
      }).then((res) => {
        if (res.isConfirmed) {
          modifyKidData(name, 0, -minutes);
          Swal.fire({ icon: 'success', title: 'å·²æ‰£é™¤', timer: 1000, showConfirmButton: false, background: '#333', color: '#fff' });
        }
      });
    }

    function customDeduct(name) {
      Swal.fire({
        title: 'è¼¸å…¥æ‰£é™¤åˆ†é˜',
        input: 'number',
        background: '#333', color: '#fff',
        showCancelButton: true
      }).then(res => {
        if (res.isConfirmed && res.value) {
          quickDeduct(name, parseInt(res.value));
        }
      });
    }

    function convertTimeToPoints(name) {
      const kid = currentData.find(k => k.Name === name);
      const mins = kid.TotalMinutes;
      const rate = 2; // 2 min = 1 pt
      const maxPts = Math.floor(mins / rate);

      if (maxPts < 1) return Swal.fire({ icon: 'info', title: 'æ™‚é–“ä¸è¶³', text: 'è‡³å°‘éœ€2åˆ†é˜', background: '#333', color: '#fff' });

      Swal.fire({
        title: 'ğŸ“º â” â­ è½‰æ›',
        text: `ç›®å‰: ${mins}åˆ† (æœ€å¤šæ› ${maxPts}é»)`,
        input: 'number',
        inputValue: 1,
        inputAttributes: { min: 1, max: maxPts },
        showCancelButton: true,
        background: '#333', color: '#fff'
      }).then((res) => {
        if (res.isConfirmed) {
          const want = parseInt(res.value);
          if (want > 0 && want <= maxPts) {
            modifyKidData(name, want, -(want * rate));
            confetti({ particleCount: 50, spread: 50, origin: { y: 0.7 } });
            Swal.fire({ icon: 'success', title: `ç²å¾— ${want} é»!`, background: '#333', color: '#fff' });
          }
        }
      });
    }

    function convertPointsToTime(name) {
      const kid = currentData.find(k => k.Name === name);
      const rate = 2; // 1 point = 2 mins

      if (kid.TotalPoints < 1) return Swal.fire({ icon: 'info', title: 'é»æ•¸ä¸è¶³', background: '#333', color: '#fff' });

      Swal.fire({
        title: 'â­ â” ğŸ“º å…Œæ›',
        text: `åŒ¯ç‡: 1é» = ${rate}åˆ†`,
        input: 'number',
        inputValue: 1,
        inputAttributes: { min: 1, max: kid.TotalPoints },
        showCancelButton: true,
        background: '#333', color: '#fff'
      }).then((res) => {
        if (res.isConfirmed) {
          const want = parseInt(res.value);
          if (want > 0 && want <= kid.TotalPoints) {
            const mins = want * rate;
            modifyKidData(name, -want, mins);
            Swal.fire({ icon: 'success', title: `å¢åŠ  ${mins} åˆ†é˜!`, background: '#333', color: '#fff' });
          }
        }
      });
    }

    function modifyKidData(name, dPoints, dMinutes) {
      const target = currentData.find(k => k.Name === name);
      if (target) {
        target.TotalPoints = Math.max(0, target.TotalPoints + dPoints);
        target.TotalMinutes = Math.max(0, target.TotalMinutes + dMinutes);
        saveData();
      }
    }

    // --- æ–°å¢ / ç·¨è¼¯ / åˆªé™¤ ---
    function addNewKid() {
      const input = document.getElementById('newKidName');
      const name = input.value.trim();
      if (!name) return;

      if (currentData.find(k => k.Name === name)) {
        return Swal.fire({ icon: 'error', title: 'åå­—å·²å­˜åœ¨', background: '#333', color: '#fff' });
      }

      currentData.push({ Name: name, TotalPoints: 0, TotalMinutes: 0 });
      saveData();
      input.value = '';
      Swal.fire({ icon: 'success', title: 'å·²æ–°å¢', timer: 1000, showConfirmButton: false, background: '#333', color: '#fff' });
    }

    function editKid(oldName) {
      Swal.fire({
        title: `ç·¨è¼¯ ${oldName}`,
        input: 'text',
        inputValue: oldName,
        showDenyButton: true,
        denyButtonText: 'åˆªé™¤',
        denyButtonColor: '#d33',
        confirmButtonText: 'æ›´å',
        showCancelButton: true,
        background: '#333', color: '#fff'
      }).then((res) => {
        if (res.isConfirmed) {
          const newName = res.value.trim();
          if (newName && newName !== oldName) {
            if (currentData.find(k => k.Name === newName)) {
              return Swal.fire({ icon: 'error', title: 'åå­—å·²å­˜åœ¨', background: '#333', color: '#fff' });
            }
            const kid = currentData.find(k => k.Name === oldName);
            kid.Name = newName;
            saveData();
          }
        } else if (res.isDenied) {
          Swal.fire({
            title: `ç¢ºå®šåˆªé™¤ ${oldName}?`,
            text: 'åˆªé™¤å¾Œç„¡æ³•å¾©åŸ',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            background: '#333', color: '#fff'
          }).then(delRes => {
            if (delRes.isConfirmed) {
              currentData = currentData.filter(k => k.Name !== oldName);
              saveData();
            }
          });
        }
      });
    }
  </script>
</body>
</html>
    </textarea>
        </div>


        <!-- Section 2: Online Version -->
        <div class="section">
          <h2>2. é›²ç«¯åŒæ­¥ç‰ˆ (Online Version)</h2>
          <p>è‹¥è¦è®“æ‰‹æ©Ÿã€é›»è…¦è³‡æ–™åŒæ­¥ï¼Œè«‹å»ºç«‹é€™å¥—ç³»çµ±ã€‚</p>

          <div class="step">
            <h3>æ­¥é©Ÿ Aï¼šéƒ¨ç½²å¾Œç«¯ (Google Apps Script)</h3>
            <p>1. å»ºç«‹ä¸€å€‹æ–°çš„ Google è©¦ç®—è¡¨ã€‚</p>
            <p>2. é»é¸ä¸Šæ–¹é¸å–® <code>Extensions (æ“´å……åŠŸèƒ½)</code> > <code>Apps Script</code>ã€‚</p>
            <p>3. åˆªé™¤ç·¨è¼¯å™¨å…§æ‰€æœ‰ç¨‹å¼ç¢¼ï¼Œè²¼ä¸Šä»¥ä¸‹å®Œæ•´ä»£ç¢¼ (<strong>ç„¡éœ€è‡ªè¡Œå¡«å…¥ IDï¼Œç¨‹å¼æœƒè‡ªå‹•æŠ“å–</strong>)ã€‚</p>

            <button onclick="copyId('code-gas')">è¤‡è£½ GAS ä»£ç¢¼</button>
            <textarea id="code-gas" readonly>
/** ========== è¨­å®šå€ ========== **/
const SHEET_NAME = 'point-sheet';
/** ============================ **/

/**
 * ğŸ› ï¸ åˆå§‹åŒ–è¨­å®š (è«‹æ‰‹å‹•åŸ·è¡Œæ­¤å‡½å¼ä¸€æ¬¡)
 * é€™æœƒè‡ªå‹•å»ºç«‹å·¥ä½œè¡¨æ¬„ä½èˆ‡å…¬å¼ï¼Œä¸¦å„²å­˜ ID ä¾› Web App ä½¿ç”¨
 */
function setupSheet() {
  // 1. è‡ªå‹•å–å¾—ç•¶å‰è©¦ç®—è¡¨ (ä¸ç”¨æ‰‹å‹•è²¼ ID)
  var ss;
  try {
    ss = SpreadsheetApp.getActiveSpreadsheet();
  } catch(e) {
    Logger.log('éŒ¯èª¤ï¼šç„¡æ³•å–å¾—è©¦ç®—è¡¨ã€‚è«‹ç¢ºèªæ‚¨æ˜¯å¾ Google Sheet > æ“´å……åŠŸèƒ½ > Apps Script é–‹å•Ÿæ­¤å°ˆæ¡ˆã€‚');
    return;
  }

  // 2. å„²å­˜ ID åˆ°è…³æœ¬å±¬æ€§ (çµ¦ doGet ä½¿ç”¨ï¼Œè§£æ±º WebApp æ‰¾ä¸åˆ° ID çš„å•é¡Œ)
  PropertiesService.getScriptProperties().setProperty('SHEET_ID', ss.getId());
  Logger.log('å·²ç¶å®šè©¦ç®—è¡¨ ID: ' + ss.getId());

  // 3. æª¢æŸ¥å·¥ä½œè¡¨
  let sheet = ss.getSheetByName(SHEET_NAME);
  if (!sheet) {
    sheet = ss.insertSheet(SHEET_NAME);
    // å¯é¸ï¼šå˜—è©¦åˆªé™¤é è¨­å·¥ä½œè¡¨
    try { ss.deleteSheet(ss.getSheetByName('Sheet1')); } catch(e){}
    try { ss.deleteSheet(ss.getSheetByName('å·¥ä½œè¡¨1')); } catch(e){}
  }

  // 4. è¨­å®š Log å€ (A1:F1)
  const headersLog = [['Timestamp', 'Family', 'Name', 'PointsChange', 'ScreenTimeChange', 'Reason']];
  const rangeLog = sheet.getRange('A1:F1');
  if(rangeLog.isBlank()) {
     rangeLog.setValues(headersLog).setFontWeight('bold').setBackground('#efefef');
  }

  // 5. è¨­å®š Leaderboard å€ (K1:M1)
  const headersBoard = [['Name', 'TotalPoints', 'TotalMinutes']];
  sheet.getRange('K1:M1').setValues(headersBoard).setFontWeight('bold').setBackground('#cfe2f3');

  // 6. è¨­å®šé è¨­è³‡æ–™
  if(sheet.getRange('K2').getValue() === '') {
      sheet.getRange('K2').setValue('Mario');
      sheet.getRange('K3').setValue('Luigi');
      sheet.getRange('L2').setFormula('=SUMIF(C:C, K2, D:D)');
      sheet.getRange('L3').setFormula('=SUMIF(C:C, K3, D:D)');
      sheet.getRange('M2').setFormula('=SUMIF(C:C, K2, E:E)');
      sheet.getRange('M3').setFormula('=SUMIF(C:C, K3, E:E)');
  }

  Logger.log('âœ… åˆå§‹åŒ–å®Œæˆï¼ç¾åœ¨å¯ä»¥é€²è¡Œéƒ¨ç½² (Deploy) äº†ã€‚');
}

/** ğŸŒ Web App æ¥å£ **/
function doGet(e) {
  // å¾å±¬æ€§ä¸­è®€å– ID (ç”± setupSheet å„²å­˜)
  const sheetId = PropertiesService.getScriptProperties().getProperty('SHEET_ID');
  if(!sheetId) return ContentService.createTextOutput('éŒ¯èª¤ï¼šè«‹å…ˆåœ¨ç·¨è¼¯å™¨åŸ·è¡Œ setupSheet() ä»¥ç¶å®šè©¦ç®—è¡¨ IDã€‚');

  const ss = SpreadsheetApp.openById(sheetId);
  const sheet = ss.getSheetByName(SHEET_NAME);

  const action = (e.parameter.action || '').toLowerCase();

  // 1. å–å¾—æ’è¡Œæ¦œ
  if (action === 'getleaderboard') {
    const lastRow = sheet.getLastRow();
    const maxRows = Math.max(0, lastRow - 1);
    let result = [];
    if (maxRows > 0) {
       const vals = sheet.getRange(2, 11, maxRows, 3).getValues();
       result = vals.filter(r => r[0]).map(r => ({
           Name: String(r[0]),
           TotalPoints: Number(r[1]) || 0,
           TotalMinutes: Number(r[2]) || 0
       }));
    }
    return ContentService.createTextOutput(JSON.stringify(result)).setMimeType(ContentService.MimeType.JSON);
  }

  // 2. æäº¤äº¤æ˜“
  if (action === 'submit') {
    const raw = e.parameter.data;
    if (!raw) return ContentService.createTextOutput('No Data');
    let obj;
    try { obj = JSON.parse(raw); } catch(err) { return ContentService.createTextOutput('JSON Error'); }
    sheet.appendRow([ new Date(), '', obj.Name || '', Number(obj.PointsChange) || 0, Number(obj.ScreenTimeChange) || 0, obj.Reason || '' ]);
    return ContentService.createTextOutput('Success');
  }

  return ContentService.createTextOutput('Unknown Action');
}
function doPost(e){ return doGet(e); }
            </textarea>

            <p>4. <strong>åŸ·è¡Œåˆå§‹åŒ–</strong>ï¼šåœ¨ç·¨è¼¯å™¨ä¸Šæ–¹çš„ä¸‹æ‹‰é¸å–®é¸æ“‡ <code>setupSheet</code>ï¼Œç„¶å¾Œé»æ“Šã€ŒåŸ·è¡Œ (Run)ã€ã€‚ç¨‹â€‹â€‹å¼æœƒè‡ªå‹•æŠ“å–ç•¶å‰è©¦ç®—è¡¨ä¸¦å»ºç«‹æ¬„ä½ã€‚</p>

            <div
              style="background:#332; padding:15px; border-radius:8px; border:1px solid #554; margin: 15px 0; font-size:14px; line-height:1.6;">
              <strong>âš ï¸ é—œæ–¼æˆæ¬Šè­¦å‘Š (Google Auth Warning)</strong><br>
              é¦–æ¬¡åŸ·è¡Œæ™‚æœƒè·³å‡ºã€Œéœ€è¦æˆæ¬Šã€è¦–çª—ï¼Œé€™æ˜¯ Google çš„æ¨™æº–ç¨‹åºï¼Œè«‹ä¾åºé»æ“Šï¼š<br>
              1. <code>å¯©æŸ¥æ¬Šé™ (Review permissions)</code><br>
              2. é¸æ“‡æ‚¨çš„ Google å¸³è™Ÿ<br>
              3. çœ‹åˆ°ã€Œæœªç¶“ Google é©—è­‰ã€è­¦å‘Šä¸ç”¨æ“”å¿ƒï¼Œé»æ“Šå·¦ä¸‹è§’çš„ <code>é€²éš (Advanced)</code><br>
              4. é»æ“Šæœ€ä¸‹æ–¹çš„ <code>å‰å¾€... (ä¸å®‰å…¨) / Go to ... (unsafe)</code><br>
              5. é»æ“Š <code>å…è¨± (Allow)</code>
            </div>

            <p>5. <strong>éƒ¨ç½² (Deploy)</strong>ï¼šé€™æ˜¯æœ€é‡è¦çš„ä¸€æ­¥ï¼Œè«‹ä»”ç´°æ“ä½œï¼š
            <ul style="padding-left: 20px; line-height: 1.8; color: #ccc;">
              <li>é»æ“Šå³ä¸Šè§’è—è‰²çš„ <code>éƒ¨ç½² (Deploy)</code> æŒ‰éˆ• > é¸æ“‡ <code>æ–°å¢éƒ¨ç½²ä½œæ¥­ (New deployment)</code>ã€‚</li>
              <li>åœ¨è·³å‡ºçš„è¦–çª—å·¦å´ã€Œé¸å–é¡å‹ã€æ—ï¼Œé»æ“Š <strong style="font-size:16px;">âš™ï¸ (é½’è¼ªåœ–ç¤º)</strong>ã€‚</li>
              <li>é¸æ“‡ <strong>ç¶²é æ‡‰ç”¨ç¨‹å¼ (Web app)</strong>ã€‚</li>
              <li>åœ¨å³å´è¨­å®šï¼š
                <ul
                  style="margin-top:5px; margin-bottom:5px; background:rgba(255,255,255,0.05); padding:10px 10px 10px 30px; border-radius:8px;">
                  <li><strong>èªªæ˜</strong>ï¼šéš¨æ„å¡«å¯« (ä¾‹å¦‚ "v1")ã€‚</li>
                  <li><strong>åŸ·è¡Œèº«åˆ† (Execute as)</strong>ï¼šé¸æ“‡ <strong>æˆ‘ (Me)</strong>ã€‚</li>
                  <li><strong>èª°å¯ä»¥å­˜å– (Who has access)</strong>ï¼šâš ï¸ <span style="color:#ff5555;font-weight:bold;">å‹™å¿…é¸æ“‡ ä»»ä½•äºº
                      (Anyone)</span>ã€‚<br>
                    <span style="font-size:12px;color:#aaa;">(è‹¥é¸ã€Œåƒ…é™æœ¬äººã€æˆ–ã€ŒGoogle å¸³æˆ¶ã€ï¼Œè·¨è£ç½®ç¶²é æœƒç„¡æ³•è®€å–è³‡æ–™)</span>
                  </li>
                </ul>
              </li>
              <li>é»æ“Šå³ä¸‹è§’çš„ <strong>éƒ¨ç½² (Deploy)</strong>ã€‚</li>
              <li>è¤‡è£½é¡¯ç¤ºçš„ <strong>ç¶²é æ‡‰ç”¨ç¨‹å¼ç¶²å€ (Web App URL)</strong>ã€‚</li>
            </ul>
            </p>

          </div>

          <div class="step" style="margin-top:40px; border-top:1px dashed #333; padding-top:30px;">
            <h3>æ­¥é©Ÿ Bï¼šéƒ¨ç½²å‰ç«¯ (ç¶²é ä»‹é¢)</h3>
            <p>å–å¾— Web App URL å¾Œï¼Œè¤‡è£½ä»¥ä¸‹ä»£ç¢¼å­˜æˆ HTML æª”ï¼Œæ‰“é–‹å¾Œè¼¸å…¥ç¶²å€å³å¯é€£ç·šã€‚</p>
            <button onclick="copyId('code-frontend')">è¤‡è£½å‰ç«¯åŸå§‹ç¢¼</button>
            <textarea id="code-frontend" readonly>
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Points & Screen Time (Online)</title>
  <link href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-dark@4/dark.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  <style>
    /* æ ¸å¿ƒæ¨£å¼ - èˆ‡ Demo ç‰ˆä¸€è‡´ */
    :root { --primary: #00d4ff; --bg-dark: #111; --bg-card: #1c1c3c; --radius-lg: 20px; }
    body { font-family: sans-serif; background: var(--bg-dark); color: #eee; text-align: center; padding: 20px 10px; margin: 0; }
    h1 { margin: 10px 0 5px; position:relative; display:inline-block; }
    
    /* è¨­å®šæŒ‰éˆ• */
    .btn-settings { 
        background: transparent; border: none; font-size: 20px; cursor: pointer; color: #666; 
        vertical-align: middle; margin-left: 8px; transition: 0.3s;
    }
    .btn-settings:hover { color: #fff; transform: rotate(90deg); }

    /* å¡ç‰‡è¨­è¨ˆ */
    .child-card {
      background: var(--bg-card); padding: 24px; margin: 18px auto; border-radius: var(--radius-lg);
      box-shadow: 0 4px 15px rgba(0, 212, 255, 0.2); max-width: 440px; position: relative; border: 1px solid rgba(255, 255, 255, 0.05);
    }
    .child-name { font-size: 26px; font-weight: 700; color: var(--primary); margin-bottom: 12px; }
    .points-box {
      background: rgba(0, 0, 0, 0.3); padding: 16px; border-radius: 16px; font-size: 36px;
      font-weight: 800; color: var(--primary); margin-bottom: 12px; border: 1px solid rgba(0, 212, 255, 0.1);
    }
    .conversion-info { font-size: 13px; color: #bbb; margin-top: 6px; font-weight: normal; }

    /* é€²åº¦æ¢ */
    .bar-wrap { background: #222; border: 2px solid rgba(0, 212, 255, 0.3); border-radius: 30px; overflow: hidden; height: 36px; position: relative; width: 100%; }
    .fill { height: 100%; transition: width 0.6s; background: linear-gradient(90deg, var(--primary), #005eff); }
    .fill.warning { background: linear-gradient(90deg, #ffaa00, #ff7700); }
    .fill.danger { background: linear-gradient(90deg, #ff4444, #ff0000); }
    .bar-text { position: absolute; width: 100%; text-align: center; top: 0; line-height: 36px; font-weight: 700; color: #fff; z-index: 2; text-shadow: 0 1px 2px #000; }
    
    /* æŒ‰éˆ• */
    .btn { padding: 10px; border-radius: 12px; border: none; width: 100%; font-weight: 700; cursor: pointer; background: #444; color: #eee; transition:0.2s; }
    .btn:hover { background: #555; }
    .btn.primary { background: var(--primary); color: #111; }
    
    .control-row { display: grid; gap: 8px; margin: 16px 0; }
    .deduct-btn { padding: 8px; border-radius: 8px; border: none; background: #333; color: #ccc; cursor: pointer; }
    .convert-group { display: flex; gap: 10px; margin-top: 10px; }

    /* æ–¹æ¡ˆåˆ‡æ› */
    .plan-toggle { background: #222; border-radius: 50px; padding: 4px; display: inline-flex; gap: 4px; margin: 10px; }
    .btn-plan { border: none; padding: 8px 20px; border-radius: 50px; background: transparent; color: #888; cursor: pointer; font-weight: 600; }
    .btn-plan.active { background: var(--primary); color: #111; }

    /* è¨­å®šèˆ‡å¾Œå° */
    #setup-box, #admin-panel { background: #2a2a5a; padding: 20px; border-radius: 20px; max-width: 440px; margin: 20px auto; border: 1px solid #444; }
    input { background: rgba(0,0,0,0.3); color: #fff; border: 1px solid #555; padding: 10px; width: 100%; margin: 5px 0; border-radius: 8px; text-align: center; box-sizing: border-box; }
    label.kid-select { display: inline-block; padding: 8px 12px; background: #333; margin: 4px; border-radius: 8px; cursor: pointer; border: 1px solid transparent; }
    label.kid-select:has(input:checked) { background: rgba(0,212,255,0.15); border-color: var(--primary); color: var(--primary); font-weight: bold; }
    label.kid-select input { display: none; }
    
    /* Settings Popup Custom */
    .setting-row { margin-bottom: 10px; text-align: left; }
    .setting-label { font-size: 14px; color: #aaa; display: block; margin-bottom: 4px; }
    .swal2-input { margin: 0 !important; width: 100% !important; background: #222 !important; color: white !important; }
  </style>
</head>
<body>

  <h1>
      â˜ï¸ Points System
      <button class="btn-settings" onclick="openSettings()" title="è¨­å®š">âš™ï¸</button>
  </h1>

  <!-- è¨­å®šå€ -->
  <div id="setup-box">
     <h3>ğŸ”Œ é€£ç·šè¨­å®š</h3>
     <p style="font-size:12px;color:#aaa;">è¼¸å…¥ Web App URL:</p>
     <input type="text" id="apiUrlInput" placeholder="https://script.google.com/..." />
     <button class="btn primary" onclick="saveUrl()">Save & Connect</button>
  </div>

  <div id="main-interface" style="display:none;">
      <!-- å¹³æ—¥/å‡æ—¥åˆ‡æ› -->
      <div class="plan-toggle">
        <button id="plan-weekday" class="btn-plan active" onclick="setAllocPlan('weekday')">å¹³æ—¥ (50m)</button>
        <button id="plan-holiday" class="btn-plan" onclick="setAllocPlan('holiday')">å‡æ—¥ (90m)</button>
      </div>
    
      <div id="leaderboard"></div>
      
      <button class="btn" style="max-width:200px;margin-top:30px;background:#333;color:#888;" onclick="document.getElementById('admin-panel').style.display='block'">
         é¡¯ç¤ºç®¡ç†å¾Œå° â–¼
      </button>

      <!-- ç®¡ç†å¾Œå° -->
      <div id="admin-panel" style="display:none;margin-top:10px;">
         <h3 style="margin-top:0;">æ‰¹æ¬¡æ›´æ–°</h3>
         <div id="kid-select-container"></div>
         <input type="number" id="ptsChange" placeholder="â­ é»æ•¸å¢æ¸›">
         <input type="number" id="timeChange" placeholder="ğŸ“º æ™‚é–“å¢æ¸›">
         <input type="text" id="reason" placeholder="åŸå› ">
         <button class="btn primary" onclick="submitBatch()">é€å‡ºæ›´æ–°</button>
         <button class="btn" onclick="loadData();" style="margin-top:10px;">ğŸ”„ é‡æ–°æ•´ç†</button>
         <button class="btn" onclick="resetUrl()" style="background:none;color:#555;font-size:12px;margin-top:10px;">é‡è¨­ç¶²å€</button>
      </div>
  </div>

  <script>
    // --- Config & Storage ---
    let API_URL = localStorage.getItem('POINTS_API_URL') || '';

    // è¨­å®šå€¼ Check
    let LIMITS = {
      weekday: parseInt(localStorage.getItem('LIMIT_WEEK') || 50),
      holiday: parseInt(localStorage.getItem('LIMIT_HOLIDAY') || 90)
    };

    let RATES = {
      time: parseInt(localStorage.getItem('RATE_TIME') || 2), // 1 pt = ? min
      cash: parseInt(localStorage.getItem('RATE_CASH') || 5)  // 1 pt = ? cash
    };

    let currentData = [];
    let allocPlan = 'weekday'; // é è¨­å¹³æ—¥

    // åˆå§‹åŒ–
    if (API_URL) {
      document.getElementById('setup-box').style.display = 'none';
      document.getElementById('main-interface').style.display = 'block';
      document.getElementById('apiUrlInput').value = API_URL;
      updatePlanUI();
      loadData();
    }

    // --- è¨­å®šåŠŸèƒ½ (Settings) ---
    function openSettings() {
      Swal.fire({
        title: 'âš™ï¸ ç³»çµ±è¨­å®š',
        html: `
                <div class="setting-row">
                    <span class="setting-label">å¹³æ—¥æ™‚é–“ä¸Šé™ (åˆ†é˜)</span>
                    <input id="set-week" class="swal2-input" type="number" value="${LIMITS.weekday}">
                </div>
                <div class="setting-row">
                    <span class="setting-label">å‡æ—¥æ™‚é–“ä¸Šé™ (åˆ†é˜)</span>
                    <input id="set-holiday" class="swal2-input" type="number" value="${LIMITS.holiday}">
                </div>
                <hr style="border-color:#444">
                <div class="setting-row">
                    <span class="setting-label">æ›ç®—ï¼š1 é» = å¹¾åˆ†é˜ ?</span>
                    <input id="set-rate-time" class="swal2-input" type="number" value="${RATES.time}">
                </div>
                <div class="setting-row">
                    <span class="setting-label">æ›ç®—ï¼š1 é» = å¤šå°‘éŒ¢ ?</span>
                    <input id="set-rate-cash" class="swal2-input" type="number" value="${RATES.cash}">
                </div>
            `,
        background: '#333', color: '#fff',
        showCancelButton: true,
        confirmButtonText: 'å„²å­˜',
        preConfirm: () => {
          return {
            w: document.getElementById('set-week').value,
            h: document.getElementById('set-holiday').value,
            rt: document.getElementById('set-rate-time').value,
            rc: document.getElementById('set-rate-cash').value
          }
        }
      }).then((result) => {
        if (result.isConfirmed) {
          const v = result.value;
          if (v.w && v.h && v.rt && v.rc) {
            LIMITS.weekday = parseInt(v.w);
            LIMITS.holiday = parseInt(v.h);
            RATES.time = parseInt(v.rt);
            RATES.cash = parseInt(v.rc);

            localStorage.setItem('LIMIT_WEEK', LIMITS.weekday);
            localStorage.setItem('LIMIT_HOLIDAY', LIMITS.holiday);
            localStorage.setItem('RATE_TIME', RATES.time);
            localStorage.setItem('RATE_CASH', RATES.cash);

            updatePlanUI();
            render();
            Swal.fire({ icon: 'success', title: 'è¨­å®šå·²æ›´æ–°', timer: 800, showConfirmButton: false, background: '#333', color: '#fff' });
          }
        }
      });
    }

    // --- æ ¸å¿ƒåŠŸèƒ½ ---

    function saveUrl() {
      const url = document.getElementById('apiUrlInput').value.trim();
      if (!url) return alert('è«‹è¼¸å…¥ç¶²å€');
      localStorage.setItem('POINTS_API_URL', url);
      API_URL = url;
      location.reload();
    }

    function resetUrl() {
      if (confirm('æ¸…é™¤é€£ç·šè¨­å®š?')) {
        localStorage.removeItem('POINTS_API_URL');
        location.reload();
      }
    }

    function setAllocPlan(plan) {
      allocPlan = plan;
      updatePlanUI();
      render();
    }

    function updatePlanUI() {
      document.querySelectorAll('.btn-plan').forEach(b => b.classList.remove('active'));
      document.getElementById('plan-' + allocPlan).classList.add('active');
      document.getElementById('plan-weekday').textContent = `å¹³æ—¥ (${LIMITS.weekday}m)`;
      document.getElementById('plan-holiday').textContent = `å‡æ—¥ (${LIMITS.holiday}m)`;
    }

    async function loadData() {
      Swal.showLoading();
      try {
        const res = await fetch(API_URL + '?action=getleaderboard');
        const data = await res.json();
        currentData = data;
        render();
        Swal.close();
      } catch (e) {
        console.error(e);
        Swal.fire({ icon: 'error', title: 'é€£ç·šå¤±æ•—', text: 'è«‹æª¢æŸ¥ç¶²å€æˆ–ç¶²è·¯' });
      }
    }

    // --- æ¸²æŸ“ UI ---
    function render() {
      const board = document.getElementById('leaderboard');
      const selectBox = document.getElementById('kid-select-container');

      const limit = LIMITS[allocPlan];

      let html = '';
      currentData.forEach(k => {
        const mins = k.TotalMinutes;
        const pts = k.TotalPoints;
        const pct = Math.min(100, (mins / limit) * 100);

        let barClass = '';
        if (pct <= 20) barClass = 'danger';
        else if (pct <= 50) barClass = 'warning';

        html += `
            <div class="child-card">
               <div class="child-name">${k.Name}</div>
               
               <div class="points-box">
                  â­ ${pts}
                  <div class="conversion-info">
                     å¯æ›ï¼šğŸ“º ${pts * RATES.time}m <span style="margin:0 5px;color:#555">|</span> ğŸ’° $${pts * RATES.cash}
                  </div>
               </div>

               <!-- é€²åº¦æ¢ -->
               <div style="text-align:left;margin-bottom:15px;">
                  <div style="display:flex;justify-content:space-between;color:#00d4ff;font-size:14px;margin-bottom:5px;">
                      <span>ğŸ“º è¢å¹•æ™‚é–“</span>
                      <span style="color:#666">ä¸Šé™ ${limit}m</span>
                  </div>
                  <div class="bar-wrap">
                      <div class="fill ${barClass}" style="width:${pct}%"></div>
                      <div class="bar-text">${mins}m</div>
                  </div>
               </div>

               <!-- å¿«æ·æ“ä½œ -->
               <div class="control-row" style="grid-template-columns: repeat(3, 1fr);">
                   <button class="deduct-btn" onclick="sendAction('${k.Name}', 0, -10, 'å¿«é€Ÿæ‰£é™¤')">-10m</button>
                   <button class="deduct-btn" onclick="sendAction('${k.Name}', 0, -30, 'å¿«é€Ÿæ‰£é™¤')">-30m</button>
                   <button class="deduct-btn" style="color:#ff6666" onclick="customDeduct('${k.Name}')">è‡ªè¨‚</button>
               </div>

               <!-- å…Œæ›æŒ‰éˆ• -->
               <div class="convert-group">
                   <button class="btn" onclick="convertTime('${k.Name}', ${mins})">ğŸ“º â” â­</button>
                   <button class="btn primary" onclick="convertPoints('${k.Name}', ${pts})">â­ â” ğŸ“º</button>
               </div>
            </div>`;
      });
      board.innerHTML = html || '<div style="color:#888;padding:20px;">è®€å–ä¸­æˆ–ç„¡è³‡æ–™...</div>';

      // æ¸²æŸ“å¾Œå°é¸å–®
      let sHtml = '';
      currentData.forEach(k => {
        sHtml += `<label class="kid-select"><input type="checkbox" name="kidSelect" value="${k.Name}"> ${k.Name}</label>`;
      });
      selectBox.innerHTML = sHtml;
    }

    // --- äº’å‹•é‚è¼¯ (API) ---

    async function sendAction(name, pChange, tChange, reason) {
      if (pChange > 0) confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });

      Swal.fire({
        title: 'æ›´æ–°ä¸­...',
        didOpen: () => Swal.showLoading(),
        background: '#333', color: '#fff'
      });

      try {
        const payload = { Name: name, PointsChange: pChange, ScreenTimeChange: tChange, Reason: reason };
        const url = API_URL + '?action=submit&data=' + encodeURIComponent(JSON.stringify(payload));
        await fetch(url);
        await loadData();
        Swal.fire({ icon: 'success', title: 'å®Œæˆ', timer: 800, showConfirmButton: false, background: '#333', color: '#fff' });
      } catch (e) {
        Swal.fire('Error', 'é€£ç·šéŒ¯èª¤', 'error');
      }
    }

    function customDeduct(name) {
      Swal.fire({
        title: 'æ‰£é™¤åˆ†é˜', input: 'number', showCancelButton: true, background: '#333', color: '#fff'
      }).then(res => {
        if (res.isConfirmed && res.value) sendAction(name, 0, -parseInt(res.value), 'è‡ªè¨‚æ‰£é™¤');
      });
    }

    function convertTime(name, currentMins) {
      const rate = RATES.time;
      const maxPts = Math.floor(currentMins / rate);
      if (maxPts < 1) return Swal.fire({ title: 'æ™‚é–“ä¸è¶³', text: `è‡³å°‘éœ€ ${rate} åˆ†é˜`, icon: 'info', background: '#333', color: '#fff' });

      Swal.fire({
        title: 'ğŸ“º â” â­', text: `ç›®å‰ ${currentMins}åˆ† (1é»=${rate}åˆ†)`,
        input: 'number', inputAttributes: { min: 1, max: maxPts },
        showCancelButton: true, background: '#333', color: '#fff'
      }).then(res => {
        if (res.isConfirmed && res.value) {
          const want = parseInt(res.value);
          sendAction(name, want, -(want * rate), 'æ™‚é–“æ›é»æ•¸');
        }
      });
    }

    function convertPoints(name, currentPts) {
      const rate = RATES.time;
      if (currentPts < 1) return Swal.fire({ title: 'é»æ•¸ä¸è¶³', icon: 'info', background: '#333', color: '#fff' });

      Swal.fire({
        title: 'â­ â” ğŸ“º', text: `ç›®å‰ ${currentPts}é» (1é»æ›${rate}åˆ†)`,
        input: 'number', inputAttributes: { min: 1, max: currentPts },
        showCancelButton: true, background: '#333', color: '#fff'
      }).then(res => {
        if (res.isConfirmed && res.value) {
          const want = parseInt(res.value);
          sendAction(name, -want, (want * rate), 'é»æ•¸æ›æ™‚é–“');
        }
      });
    }

    async function submitBatch() {
      const checks = document.querySelectorAll('input[name="kidSelect"]:checked');
      if (checks.length === 0) return Swal.fire('è«‹é¸æ“‡å°è±¡');

      const pts = document.getElementById('ptsChange').value;
      const time = document.getElementById('timeChange').value;
      const reason = document.getElementById('reason').value;

      if (!pts && !time) return Swal.fire('è«‹è¼¸å…¥æ•¸å€¼');

      Swal.fire({ title: 'æ‰¹æ¬¡æ›´æ–°ä¸­...', didOpen: () => Swal.showLoading(), background: '#333', color: '#fff' });

      for (let chk of checks) {
        const payload = { Name: chk.value, PointsChange: pts, ScreenTimeChange: time, Reason: reason };
        await fetch(API_URL + '?action=submit&data=' + encodeURIComponent(JSON.stringify(payload)));
      }

      document.getElementById('ptsChange').value = '';
      document.getElementById('timeChange').value = '';
      document.querySelectorAll('input[name="kidSelect"]').forEach(c => c.checked = false);

      await loadData();
      Swal.fire({ icon: 'success', title: 'å…¨éƒ¨å®Œæˆ', timer: 1000, background: '#333', color: '#fff', showConfirmButton: false });
    }
  </script>
</body>
</html>
    </textarea>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="footer-nav">
      <div>Â© 2025 Evelyn YT Liu. All Rights Reserved.</div>
      <div style="margin-top: 10px;">
        <a href="../index.html" style="color: var(--primary); text-decoration: none; font-size: 0.9em;">
          â† Back to Portfolio
        </a>
      </div>
    </div>

</body>

</html>